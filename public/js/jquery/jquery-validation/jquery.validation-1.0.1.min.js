/**
 * jQuery Form Validation
 *
 * @author Tom Bertrand
 * @version 1.0.0 (2014-05-22)
 *
 * @copyright
 * Copyright (C) 2014 Tom Bertrand.
 *
 * @link
 * http://www.runningcoder.org/jqueryvalidation/
 *
 * @license
 * Licensed under the MIT license.
 */
(function(window,document,$,undefined){window.Validation={};var _rules={NOTEMPTY:/./,NUMERIC:/^[0-9]+$/,MIXED:/^[\w\s-]+$/,NOSPACE:/^[^\s]+$/,TRIM:/^[^\s].*[^\s]$/,DATE:/^\d{4}-\d{2}-\d{2}(\s\d{2}:\d{2}(:\d{2})?)?$/,EMAIL:/^([^@]+?)@(([a-z0-9]-*)*[a-z0-9]+\.)+([a-z0-9]+)$/i,URL:/^(https?:\/\/)?((([a-z0-9]-*)*[a-z0-9]+\.?)*([a-z0-9]+))(\/[\w?=\.-]*)*$/,PHONE:/^(\()?\d{3}(\))?(-|\s)?\d{3}(-|\s)\d{4}$/,OPTIONAL:/^.*$/,COMPARISON:/^\s*([LV])\s*([<>]=?|==|!=)\s*([^<>=!]+?)\s*$/};var _message={"default":"$ contain error(s).",NOTEMPTY:"$ must not be empty.",NUMERIC:"$ must be numeric.",STRING:"$ must be a string.",NOSPACE:"$ must not contain spaces.",TRIM:"$ must not start or end with space character.",MIXED:"$ must be letters or numbers (no special characters).",DATE:"$ is not a valid with format YYYY-MM-DD.",EMAIL:"$ is not valid.",URL:"$ is not valid.",PHONE:"$ is not a valid phone number.","<":"$ must be less than % characters.","<=":"$ must be less or equal to % characters.",">":"$ must be greater than % characters.",">=":"$ must be greater or equal to % characters.","==":"$ must be equal to %","!=":"$ must be different than %"};var _data={validation:"data-validation",validationMessage:"data-validation-message",regex:"data-validation-regex",regexMessage:"data-validation-regex-message",validationGroup:"data-validation-group",errorList:"data-error-list"};var _options={submit:{settings:{form:null,display:"inline",insertion:"append",allErrors:false,trigger:"click",button:"input[type='submit']",errorClass:"error",errorListClass:"error-list",inputContainer:null,clear:"focusin"},callback:{onInit:null,onValidate:null,onError:null,onBeforeSubmit:null,onSubmit:null,onAfterSubmit:null}},dynamic:{settings:{trigger:null,delay:300},callback:{onSuccess:null,onError:null,onComplete:null}}};var _supported={submit:{settings:{display:["inline","block"],insertion:["append","prepend"],allErrors:[true,false],clear:["focusin","keypress",false],trigger:["click","dblclick","focusout","hover","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","toggle"]}},dynamic:{settings:{trigger:["focusout","keydown","keypress","keyup"]}}};if(typeof Object.preventExtensions!=="function"){Object.preventExtensions=function(e){return e}}var Validation=function(node,options){function extendOptions(){if(!(options instanceof Object)){options={}}var e=Object.preventExtensions($.extend(true,{},_options));for(var t in options){if(!options.hasOwnProperty(t)||!(options[t]instanceof Object)){continue}for(var n in options[t]){if(!options[t].hasOwnProperty(n)||!(options[t][n]instanceof Object)){continue}for(var r in options[t][n]){if(!options[t][n].hasOwnProperty(r)){continue}if(_supported[t]&&_supported[t][n]&&_supported[t][n][r]&&$.inArray(options[t][n][r],_supported[t][n][r])===-1){window.debug("Validation.extendOptions - Delete unsupported property - "+n+": {"+r.toString()+": "+options[t][n][r].toString()+"}");delete options[t][n][r]}}if(e[t]&&e[t][n]){e[t][n]=$.extend(Object.preventExtensions(e[t][n]),options[t][n])}}}options=e}function delegateDynamicValidation(){if(!options.dynamic.settings.trigger){return false}$.each($(node).find("["+_data.validation+"]:not([disabled]),["+_data.regex+"]:not([disabled])"),function(e,t){$(t).unbind(options.dynamic.settings.trigger).on(options.dynamic.settings.trigger,function(e){var t=this;_typeWatch(function(){if(!validateInput(t)){displayOneError(t.name);_executeCallback(options.dynamic.callback.onError,[node,t,errors[t.name]])}else{_executeCallback(options.dynamic.callback.onSuccess,[node,t])}_executeCallback(options.dynamic.callback.onComplete,[node,t])},options.dynamic.settings.delay)})})}function delegateValidation(){_executeCallback(options.submit.callback.onInit,[node]);$(node).on("submit",false);$(node).find(options.submit.settings.button).unbind(options.submit.settings.trigger).on(options.submit.settings.trigger,function(e){e.preventDefault();resetErrors();_executeCallback(options.submit.callback.onValidate,[node]);if(!validateForm()){_executeCallback(options.submit.callback.onError,[node,errors]);displayErrors()}else{_executeCallback(options.submit.callback.onBeforeSubmit,[node]);options.submit.callback.onSubmit?_executeCallback(options.submit.callback.onSubmit,[node]):submitForm();_executeCallback(options.submit.callback.onAfterSubmit,[node])}return false})}function validateForm(){$.each($(node).find("["+_data.validation+"]:not([disabled]),["+_data.regex+"]:not([disabled])"),function(e,t){validateInput(t)});return $.isEmptyObject(errors)}function validateInput(e){var t=$(e).attr("name");if(!t){window.debug("Validation.validateInput - Invalid {string} inputName on "+e.toString());return false}var n=_getInputValue(e),r=t.replace(/]$/,"").split(/]\[|[[\]]/g),i=r[r.length-1],s=$(e).attr(_data.validation),o=$(e).attr(_data.validationMessage),u=$(e).attr(_data.regex),a=$(e).attr(_data.regexMessage),f=false;if(s){s=_api._splitValidation(s)}if(!$.isEmptyObject(s)){if(n===""&&$.inArray("OPTIONAL",s)!==-1){return true}$.each(s,function(e,r){if(f===true){return true}try{validateRule(n,r)}catch(s){if(o||!options.submit.settings.allErrors){f=true}s[0]=o||s[0];registerError(t,s[0].replace("$",i).replace("%",s[1]))}})}if(u){var l=u.split("/");if(l.length>1){var c="";for(var h=0;h<l.length-1;h++){if(l[h]!==""){c+=l[h]+"/"}}c=c.slice(0,-1);if(/[gimsxeU]+/.test(l[l.length-1])){var p=l[l.length-1]}l=c}else{l=l[0]}try{var d=new RegExp(l,p)}catch(v){window.debug("Invalid data-validation-regex on "+t);return true}try{validateRule(n,d)}catch(v){v[0]=a||v[0];registerError(t,v[0].replace("$",i))}}return $.isEmptyObject(errors[t])}function validateRule(value,rule){if(rule instanceof RegExp){if(rule.test(value)){throw[_message["default"],""]}return}if(_rules[rule]){if(!_rules[rule].test(value)){throw[_message[rule],""]}return}var comparison=rule.match(_rules["COMPARISON"]);if(!comparison||comparison.length!==4){window.debug("Validation.validateRule - Invalid validation rule: "+rule);return}var type=comparison[1],operator=comparison[2],compared=comparison[3],comparedValue;switch(type){case"L":if(isNaN(compared)){comparedValue=$(node).find('[name="'+compared+'"]').val();if(!comparedValue){window.debug('$.Validation.validateRule - Unable to find value of input[name="'+compared+'"] inside rule '+rule);return false}if(!value||!eval('"'+encodeURIComponent(value)+'"'+operator+'"'+encodeURIComponent(comparedValue)+'"')){throw[_message[operator],compared]}}else{if(!value||eval(value.length+operator+parseFloat(compared))==false){throw[_message[operator],compared]}}break;case"V":default:if(isNaN(compared)){comparedValue=$(node).find('[name="'+compared+'"]').val();if(!comparedValue){window.debug('$.Validation.validateRule - Unable to find value of input[name="'+compared+'"] inside rule '+rule);return false}if(!value||!eval('"'+encodeURIComponent(value)+'"'+operator+'"'+encodeURIComponent(comparedValue)+'"')){throw[_message[operator].replace(" characters",""),compared]}}else{if(!value||!eval(value+operator+parseFloat(compared))){throw[_message[operator].replace(" characters",""),compared]}}break}}function registerError(e,t){if(!errors[e]){errors[e]=[]}errors[e].push(t.capitalize())}function displayOneError(e){var t,n,r,i,s='<div class="'+options.submit.settings.errorListClass+'" '+_data.errorList+"><ul></ul></div>",o,u;if(!errors.hasOwnProperty(e)){return false}t=$(node).find('[name="'+e+'"]');i=null;if(!t[0]){window.debug("Validation.displayOneError unable to find "+e);return false}o=t.attr(_data.validationGroup);if(o){u=$(node).find('[name="'+e+'"]');i=$(node).find('[id="'+o+'"]');if(i[0]){i.addClass(options.submit.settings.errorClass);r=i}}else{t.addClass(options.submit.settings.errorClass);if(options.submit.settings.inputContainer){t.parentsUntil(node,options.submit.settings.inputContainer).addClass(options.submit.settings.errorClass)}n=t.attr("id");if(n){i=$(node).find('label[for="'+n+'"]')[0]}if(!i){i=t.parentsUntil(node,"label")[0]}if(i){i=$(i);i.addClass(options.submit.settings.errorClass)}}if(options.submit.settings.display==="inline"){r=r||t.parent()}else if(options.submit.settings.display==="block"){r=$(node)}if(options.submit.settings.display==="inline"||options.submit.settings.display==="block"&&!r.find("["+_data.errorList+"]")[0]){if(options.submit.settings.insertion==="append"){r.append(s)}else if(options.submit.settings.insertion==="prepend"){r.prepend(s)}}for(var a=0;a<errors[e].length;a++){r.find("ul").append("<li>"+errors[e][a]+"</li>")}if(options.submit.settings.clear||options.dynamic.settings.trigger){if(o&&u){t=u}t.unbind(options.submit.settings.clear).on(options.submit.settings.clear+" "+options.dynamic.settings.trigger,function(e,t,n,r,i){return function(){if(i){if($(n).hasClass(options.submit.settings.errorClass)){resetOneError(e,t,n,r,i)}}else if($(t).hasClass(options.submit.settings.errorClass)){resetOneError(e,t,n,r)}}}(e,t,i,r,o))}}function displayErrors(){for(var e in errors){displayOneError(e)}if(options.submit.settings.display==="block"){if(typeof $.scrollTo==="function"){$.scrollTo(node,500,{offset:-100})}}}function resetOneError(e,t,n,r,i){try{delete errors[e]}catch(s){window.debug("Validation.resetOneError unable to find and delete "+e+" inside {object} errors.");return false}if(options.submit.settings.inputContainer){(i?n:t).parentsUntil(node,options.submit.settings.inputContainer).removeClass(options.submit.settings.errorClass)}n&&n.removeClass(options.submit.settings.errorClass);t.removeClass(options.submit.settings.errorClass);if(options.submit.settings.display==="inline"){r.find("["+_data.errorList+"]").remove()}}function resetErrors(){errors=[];$(node).find("["+_data.errorList+"]").remove();$(node).find("."+options.submit.settings.errorClass).removeClass(options.submit.settings.errorClass)}function submitForm(){node.submit()}var errors=[];var _typeWatch=function(){var e=0;return function(t,n){clearTimeout(e);e=setTimeout(t,n)}}();var _getInputValue=function(e){var t;switch($(e).attr("type")){case"checkbox":t=$(e).is(":checked")?1:"";break;case"radio":t=$(node).find('input[name="'+$(e).attr("name")+'"]:checked').val()||"";break;default:t=$(e).val();break}return t};var _executeCallback=function(e,t){if(!e){return false}var n;if(typeof e==="function"){n=e}else if(typeof e==="string"||e instanceof Array){n=window;if(typeof e==="string"){e=[e,[]]}var r=e[0].split("."),i=e[1],s=true,o=0;while(o<r.length){if(typeof n!=="undefined"){n=n[r[o++]]}else{s=false;break}}if(!s||typeof n!=="function"){window.debug("Validation._executeFunction - Invalid function - "+e[0].toString());return false}}n.apply(this,$.merge(i||[],t?t:[]));return true};this.__construct=function(){extendOptions();delegateDynamicValidation();delegateValidation()}();return{registerError:registerError,displayOneError:displayOneError,displayErrors:displayErrors}};$.fn.validate=$.validate=function(e){return _api.validate(this,e)};$.fn.addValidation=function(e){return _api.addValidation(this,e)};$.fn.removeValidation=function(e){return _api.removeValidation(this,e)};$.fn.addError=function(e){return _api.addError(this,e)};var _api={_formatValidation:function(e){e=e.toString().replace(/\s/g,"");if(e.charAt(0)==="["&&e.charAt(e.length-1)==="]"){e=e.replace(/^\[|\]$/g,"")}return e},_splitValidation:function(e){var t=this._formatValidation(e).split(","),n;for(var r=0;r<t.length;r++){n=t[r];if(/^[a-z]+$/i.test(n)){t[r]=n.toUpperCase()}}return t},_joinValidation:function(e){return"["+e.join(", ")+"]"},validate:function(e,t){if(typeof e==="function"){if(!t.submit.settings.form){window.debug('$.validate - Undefined property "options.submit.settings.form" - Validation dropped.');return}e=$(t.submit.settings.form);if(!e[0]){window.debug('$.validate - Unable to find jQuery form element "options.submit.settings.form" - '+t.submit.settings.form+" - Validation dropped.");return}}else if(typeof e[0]==="undefined"){window.debug('$("'+e["selector"]+'").validate() - Unable to find jQuery element - Validation dropped.');return}return e.each(function(){window.Validation[e.selector]=new Validation(this,t)})},addValidation:function(e,t){var n=this;t=n._splitValidation(t);if(!t){return false}return e.each(function(){var e=$(this),r=e.attr(_data.validation),i=r&&r.length?n._splitValidation(r):[],s;for(var o=0;o<t.length;o++){s=n._formatValidation(t[o]);if($.inArray(s,i)===-1){i.push(s)}}if(i.length){e.attr(_data.validation,n._joinValidation(i))}})},removeValidation:function(e,t){var n=this;t=n._splitValidation(t);if(!t){return false}return e.each(function(){var e=$(this),r=e.attr(_data.validation),i=r&&r.length?n._splitValidation(r):[],s,o;if(!i.length){e.removeAttr(_data.validation);return true}for(var u=0;u<t.length;u++){s=n._formatValidation(t[u]);o=$.inArray(s,i);if(o!==-1){i.splice(o,1)}}if(!i.length){e.removeAttr(_data.validation);return true}e.attr(_data.validation,n._joinValidation(i))})},addError:function(e,t){if(!window.Validation[e.selector]){window.debug("$.addError - Invalid node selector - Make sure you are using the same one you initialize the Validation with.");return false}if(typeof t!=="object"||$.isEmptyObject(t)){window.debug("$.addError - Invalid error object.");return false}for(var n in t){if(!t.hasOwnProperty(n)){continue}if(typeof t[n]==="string"){window.Validation[e.selector].registerError(n,t[n])}else if(t[n]instanceof Array){for(var r=0;r<t[n].length;r++){window.Validation[e.selector].registerError(n,t[n][r])}}else{window.debug('$.addError - Invalid error object property - Accepted format: {"inputName": "errorString"} or {"inputName": ["errorString", "errorString"]}.');continue}window.Validation[e.selector].displayOneError(n)}}};window.debug=function(){if(this.console&&this.console.debug){this.console.debug("DEBUG: "+Array.prototype.slice.call(arguments))}else{window.log("DEBUG: "+Array.prototype.slice.call(arguments))}};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}})(window,document,window.jQuery)